<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DEI CMT</title>
    <link rel="shortcut icon" href="/dei_logo.png" type="image/x-icon">
    <link rel="stylesheet" href="/styles.css">
  </head>
  <body>
    <%- include('../partials/dashboard/header') %>

    <div class="container">
      
      
      <h4>Manage Poster Presentation Sessions</h4>
      <h6>Conference: <%= conference.title %></h6>
      <hr />

      <!-- Poster Session Setup -->
      <div class="card mb-4">
        <div class="card-body p-4">
          <div class="mb-3">
            <h5 class="card-title mb-2">Session Details</h5>
          </div>

          <form action="/chair/dashboard/set-poster-session/<%= conference.conference_id %>" method="POST">
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="session_date" class="form-label">Session Date</label>
                <input 
                  type="date" 
                  class="form-control" 
                  id="session_date" 
                  name="session_date" 
                  value="<%= posterSession && posterSession.date ? posterSession.date : '' %>"
                  required
                />
              </div>
              <div class="col-md-4 mb-3">
                <label for="start_time" class="form-label">Start Time</label>
                <input 
                  type="time" 
                  class="form-control" 
                  id="start_time" 
                  name="start_time" 
                  value="<%= posterSession && posterSession.start_time ? posterSession.start_time : '' %>"
                  required
                />
              </div>
              <div class="col-md-4 mb-3">
                <label for="end_time" class="form-label">End Time</label>
                <input 
                  type="time" 
                  class="form-control" 
                  id="end_time" 
                  name="end_time" 
                  value="<%= posterSession && posterSession.end_time ? posterSession.end_time : '' %>"
                  required
                />
              </div>

              <div class="col-md-4 mb-3">
                <label for="coordinators" class="form-label">Coordinators</label>
               <textarea required name="coordinators" placeholder="Email IDs of the Coordinators (seperated by comma)" class="form-control"></textarea>
              </div>

            </div>
            <input type="hidden" name="conference_id" value="<%= conference.conference_id %>">
            <button type="submit" class="btn btn-success">
              Save Session Details
            </button>
          </form>

          <!-- Display Current Session Details -->
          <% if (posterSession && (posterSession.date || posterSession.start_time || posterSession.end_time)) { %>
            <hr class="my-3">
              <p class="mb-2"><strong>Current Session Details:</strong></p>
              <table class="table table-sm table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Date</th>
                    <th scope="col">Start Time</th>
                    <th scope="col">End Time</th>
                    <th scope="col">Coordinators</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><%= posterSession.date || 'Not set' %></td>
                    <td><%= posterSession.start_time || 'Not set' %></td>
                    <td><%= posterSession.end_time || 'Not set' %></td>
                    <td><%= posterSession.coodinators %></td>
                  </tr>
                </tbody>
              </table>
            
          <% } %>
        </div>
      </div>

      <!-- Leaderboard Accordion -->
      <div class="accordion mt-4 mb-4" id="leaderboardAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingLeaderboard">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLeaderboard" aria-expanded="false" aria-controls="collapseLeaderboard">
              <i class="bi bi-trophy me-2"></i>View Leaderboard
            </button>
          </h2>
          <div id="collapseLeaderboard" class="accordion-collapse collapse" aria-labelledby="headingLeaderboard" data-bs-parent="#leaderboardAccordion">
            <div class="accordion-body p-0">
              <% if (leaderboard && leaderboard.length > 0) { %>
                <div class="table-responsive">
                  <table class="table table-striped table-sm table-hover mb-0 leaderboard-table">
                    <thead class="table-light">
                      <tr>
                        <th style="min-width: 60px;">Rank</th>
                        <th style="min-width: 150px;">Paper Title</th>
                        <th style="min-width: 120px;">Primary Author</th>
                        <th style="min-width: 120px;">Co-Authors</th>
                        <th style="min-width: 90px;">Reviewer</th>
                        <th style="min-width: 90px;">Panelist</th>
                        <th style="min-width: 90px;">Average</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% leaderboard.forEach(function(submission) { %>
                        <tr>
                          <td style="white-space: nowrap;">
                            <% if (submission.rank) { %>
                              <% if (submission.rank === 1) { %>
                                 <i class="bi bi-1-circle-fill"></i>
                              <% } else if (submission.rank === 2) { %>
                                 <i class="bi bi-2-circle-fill"></i>
                              <% } else if (submission.rank === 3) { %>
                                 <i class="bi bi-3-circle-fill"></i>
                              <% } else { %>
                                #<%= submission.rank %>
                              <% } %>
                            <% } else { %>
                              <span class="text-muted">N/A</span>
                            <% } %>
                          </td>
                          <td>
                            <div class="fw-bold"><%= submission.title %></div>
                            <small class="text-muted">Status: <%= submission.submission_status %></small>
                          </td>
                          <td><%= submission.primary_author_formatted %></td>
                          <td><%= submission.co_authors_formatted %></td>
                          <td style="text-align: center;">
                            <% if (submission.reviewerScore !== null) { %>
                              <span class="badge bg-primary"><%= submission.reviewerScore %>/5</span>
                            <% } else { %>
                              <span class="badge bg-secondary">N/A</span>
                            <% } %>
                          </td>
                          <td style="text-align: center;">
                            <% if (submission.panelistScore !== null) { %>
                              <span class="badge bg-success"><%= submission.panelistScore %>/5</span>
                            <% } else { %>
                              <span class="badge bg-secondary">N/A</span>
                            <% } %>
                          </td>
                          <td style="text-align: center;">
                            <% if (submission.averageScore !== null) { %>
                              <span class="badge bg-<%= submission.averageScore >= 4 ? 'success' : submission.averageScore >= 3 ? 'warning' : 'danger' %> fs-6">
                                <%= submission.averageScore %>/5
                              </span>
                            <% } else { %>
                              <span class="badge bg-secondary">N/A</span>
                            <% } %>
                          </td>
                        </tr>
                      <% }); %>
                    </tbody>
                  </table>
                </div>
              <% } else { %>
                <div class="text-center text-muted p-4">
                  <i class="bi bi-inbox display-4"></i>
                  <p class="mt-2"><b>No submissions have been marked as "Completed"!</b></p>
                </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>

      <!-- Poster Submissions List -->
      <h5>Final Camera Ready Papers (Accepted for Poster Presentation)</h5>
      <hr />

      <% if (submissions && submissions.length > 0) { %>
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-light">
              <tr>
                <th scope="col">Paper Title</th>
                <th scope="col">Primary Author</th>
                <th scope="col">Co-Authors</th>
                <th scope="col">View Paper</th>
              </tr>
            </thead>
            <tbody>
              <% submissions.forEach(function(submission, idx) { %>
                <tr>
                  <td>
                    <strong><%= submission.title %></strong>
                  </td>
                  <td><%= submission.primary_author_formatted %></td>
                  <td><%= submission.co_authors_formatted %></td>
                  <td><a href="<%= submission.file_url %>" target="_blank">Click Here</a></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        
            <strong><i class="bi bi-emoji-frown-fill"></i> No Final Camera Ready Papers have been submitted!</strong>
      
      <% } %>

      

    
    </div>

    <script src="/script.js"></script>

    <%- include('../partials/footer') %>
  </body>
</html>
