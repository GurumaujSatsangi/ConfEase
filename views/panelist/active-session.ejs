<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DEI CMT</title>
    <link rel="shortcut icon" href="/dei_logo.png" type="image/x-icon">
    <link rel="stylesheet" href="/styles.css" />
    
  </head>
  <body>
    <%- include('../partials/dashboard/header') %>
     

    
      

      <div class="container">
        <h4>Panelist's Dashboard</h4>
        <h6><%= trackinfo.track_name %></h6>
        
        <hr>
    
<% if (session && session.length > 0) { %> <%
        session.forEach(function(session) { %>
        <table class="table">

          <tr>
            <td><b>Paper Title</b></td>
            <td><b>Mean Score awarded by Reviewer</b></td>
            <td><b>View Paper</b></td>
            <td><b>Panelist Score</b></td>
          </tr>
          <tr>
               <form action="/mark-presentation-as-complete" method="POST">
    <input type="hidden" name="paper_id" value="<%= session.submission_id %>">
        <input type="hidden" name="track_id" value="<%= trackinfo.track_id %>">


            <td><%= session.title %></td>
            <td>
              <% if (session.mean_score !== null && session.mean_score !== undefined) { %>
                <span class="badge bg-primary"><%= session.mean_score %></span>
              <% } else { %>
                <span class="badge bg-secondary">Not Reviewed</span>
              <% } %>
            </td>
            <td><a href="<%= session.file_url%>" target="_blank"><i class="bi bi-cloud-arrow-down-fill"></i></a></td>
            
            <% if (session.presentation_status === 'Completed' || session.submission_status === 'Presentation Completed') { %>
            <td>
              <span class="badge bg-success">
                <% if (session.panelist_score !== null && session.panelist_score !== undefined) { %>
                  <%= session.panelist_score %> <i class="bi bi-check-circle-fill"></i>
                <% } else { %>
                  Completed <i class="bi bi-check-circle-fill"></i>
                <% } %>
              </span>
            </td>
            <td></td>
            <% } else { %>
            <td><input type="number" class="form-control" max="5" step="0.1" id="panelist_score" name="panelist_score" required></td>
            <td><input type="submit" class="btn btn-outline-primary" value="Save"></td>
            <% } %>
          </form> 

          </tr>
        </table>
        
        <% }); %> <% } else { %>
        <h2>No Submissions Found</h2>
        <% } %>
    </main>
<% if (message) { %>
  <script>
    Swal.fire({
      title: 'Alert',
      text: '<%= message %>',
      icon: 'info',
      confirmButtonText: 'OK'
    });
    if (window.location.search.includes('message=')) {
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  </script>
  <% } %>

      </div>
    <script src="/script.js"></script>
    <%- include('../partials/footer')%>
  </body>
</html>
